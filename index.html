<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenRouter AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(156,163,175,0.4); border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        .message-enter { animation: messageSlideIn 0.3s ease-out; }
        @keyframes messageSlideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .typing-indicator span { animation: typingBounce 1.4s infinite ease-in-out; }
        @keyframes typingBounce { 0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
        .glow-blue { box-shadow: 0 0 20px rgba(0, 123, 255, 0.3); }
        .gradient-text { background: linear-gradient(135deg, #007BFF 0%, #00D4FF 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        /* Code block styles */
        .code-block { animation: codeFadeIn 0.3s ease-out; }
        @keyframes codeFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .code-block pre { margin: 0; }
        .code-block code { font-family: 'Fira Code', 'Consolas', monospace; line-height: 1.6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const Icons = {
            Plus: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            ),
            MessageSquare: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
            ),
            Send: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
            ),
            Paperclip: () => (
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                </svg>
            ),
            Menu: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            ),
            X: () => (
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            ),
            Settings: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            ),
            User: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            ),
            Moon: () => (
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            ),
            Sun: () => (
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            ),
            MoreHorizontal: () => (
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="1"/>
                    <circle cx="19" cy="12" r="1"/>
                    <circle cx="5" cy="12" r="1"/>
                </svg>
            ),
            FileText: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                </svg>
            ),
            Copy: () => (
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
            ),
            Check: () => (
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
            ),
            XCircle: () => (
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
            ),
            Download: () => (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
            ),
            Bot: ({ size = 40, className = "" }) => (
                <svg width={size} height={size} viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" className={className}>
                    <defs>
                        <linearGradient id="botGrad" x1="4" y1="6" x2="44" y2="42">
                            <stop stopColor="#007BFF"/>
                            <stop offset="1" stopColor="#0056b3"/>
                        </linearGradient>
                    </defs>
                    <rect x="8" y="8" width="32" height="36" rx="8" fill="url(#botGrad)"/>
                    <circle cx="16" cy="20" r="3" fill="white"/>
                    <circle cx="32" cy="20" r="3" fill="white"/>
                    <rect x="14" y="30" width="20" height="4" rx="2" fill="white"/>
                    <rect x="18" y="36" width="12" height="4" rx="1" fill="white" opacity="0.7"/>
                </svg>
            )
        };
        
        function AIChat() {
            const [darkMode, setDarkMode] = useState(true);
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [attachments, setAttachments] = useState([]);
            const [showWelcome, setShowWelcome] = useState(true);
            const [chatHistory, setChatHistory] = useState([]);
            const [currentChatId, setCurrentChatId] = useState(null);
            const [expandedAttachment, setExpandedAttachment] = useState(null);
            
            const messagesEndRef = useRef(null);
            const textareaRef = useRef(null);
            const fileInputRef = useRef(null);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑ localStorage
            useEffect(function() {
                const saved = localStorage.getItem('chat_history');
                if (saved) {
                    try {
                        setChatHistory(JSON.parse(saved));
                    } catch (e) {}
                }
            }, []);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            function saveChatToHistory(title) {
                const chatId = currentChatId || Date.now();
                const chatTitle = title || (messages.length > 1 ? messages[1]?.content?.substring(0, 30) || '–ù–æ–≤—ã–π —á–∞—Ç' : '–ù–æ–≤—ã–π —á–∞—Ç');
                
                const newChat = {
                    id: chatId,
                    title: chatTitle,
                    date: '–°–µ–≥–æ–¥–Ω—è',
                    messages: messages.map(m => ({ role: m.role, content: m.content, timestamp: m.timestamp }))
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º —á–∞—Ç
                let updated;
                const existingIndex = chatHistory.findIndex(c => c.id === chatId);
                if (existingIndex >= 0) {
                    updated = [...chatHistory];
                    updated[existingIndex] = newChat;
                } else {
                    updated = [newChat, ...chatHistory];
                }
                
                setChatHistory(updated);
                setCurrentChatId(chatId);
                localStorage.setItem('chat_history', JSON.stringify(updated));
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
            function loadChat(chatId) {
                const chat = chatHistory.find(c => c.id === chatId);
                if (chat && chat.messages) {
                    setMessages(chat.messages.map((m, i) => ({
                        ...m,
                        id: Date.now() + i
                    })));
                    setShowWelcome(false);
                    setCurrentChatId(chatId);
                    setInput('');
                    setAttachments([]);
                }
            }
            
            // –£–¥–∞–ª—è–µ–º —á–∞—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
            function deleteChat(e, chatId) {
                e.stopPropagation();
                const updated = chatHistory.filter(c => c.id !== chatId);
                setChatHistory(updated);
                localStorage.setItem('chat_history', JSON.stringify(updated));
                
                // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Ç–µ–∫—É—â–∏–π —á–∞—Ç, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π
                if (currentChatId === chatId) {
                    setCurrentChatId(null);
                    setMessages(demoMessages);
                    setShowWelcome(true);
                }
            }
            
            const demoMessages = [
                {
                    id: 1,
                    role: 'assistant',
                    content: '–ü—Ä–∏–≤–µ—Ç! –Ø AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –±–∞–∑–µ OpenRouter (–º–æ–¥–µ–ª—å Arcee AI).\n\n–í–æ—Ç –ø—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –≤ Excel:\n\n| ‚Ññ | –î–∞—Ç–∞ | –ö–ª–∏–µ–Ω—Ç | –°—É–º–º–∞ | –°—Ç–∞—Ç—É—Å |\n| --- | --- | --- | --- | --- |\n| 1 | 01.01.2024 | –¢–û–í "–†–æ–≥–∞" | 15,000 –≥—Ä–Ω | –í–∏–∫–æ–Ω–∞–Ω–æ |\n| 2 | 05.01.2024 | –ü–ü "–ö–æ–ø—ã—Ç–∞" | 8,500 –≥—Ä–Ω | –í —Ä–æ–±–æ—Ç—ñ |\n| 3 | 10.01.2024 | –§–û–ü "–Ü–≤–∞–Ω–æ–≤" | 25,000 –≥—Ä–Ω | –û—á—ñ–∫—É—î |\n\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Excel" –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è!',
                    timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                }
            ];
            
            const [messages, setMessages] = useState(demoMessages);
            
            const theme = {
                bg: darkMode ? 'bg-[#0a0e17]' : 'bg-[#f8f9fa]',
                bgSidebar: darkMode ? 'bg-[#0d1119]' : 'bg-[#ffffff]',
                bgHover: darkMode ? 'hover:bg-[#1a2332]' : 'hover:bg-[#f1f3f4]',
                text: darkMode ? 'text-[#e8eaed]' : 'text-[#1a1a1a]',
                textSecondary: darkMode ? 'text-[#9aa0a6]' : 'text-[#5f6368]',
                textMuted: darkMode ? 'text-[#6b7280]' : 'text-[#9aa0a6]',
                border: darkMode ? 'border-[#2d3748]' : 'border-[#e8e8e8]',
                userBubble: darkMode ? 'bg-[#238636]' : 'bg-[#1a1a1a]',
                inputBg: darkMode ? 'bg-[#171e2e]' : 'bg-[#ffffff]',
            };
            
            useEffect(function() {
                if (messagesEndRef.current) {
                    messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [messages, showWelcome]);
            
            useEffect(function() {
                if (textareaRef.current) {
                    textareaRef.current.style.height = 'auto';
                    textareaRef.current.style.height = Math.min(textareaRef.current.scrollHeight, 200) + 'px';
                }
            }, [input]);
            
            function handleSend() {
                if (!input.trim() && attachments.length === 0) return;
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º Excel —Ñ–∞–π–ª–æ–≤
                let messageContent = input;
                const excelFiles = attachments.filter(a => a.type === 'excel');
                
                if (excelFiles.length > 0) {
                    messageContent += '\n\n=== –í–õ–û–ñ–ï–ù–ù–´–ï –§–ê–ô–õ–´ ===\n';
                    excelFiles.forEach(function(file) {
                        messageContent += file.content + '\n';
                    });
                }
                
                const userMsg = {
                    id: Date.now(),
                    role: 'user',
                    content: messageContent,
                    timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                };
                
                setMessages(function(prev) { return [...prev, userMsg]; });
                setInput('');
                setAttachments([]);
                setShowWelcome(false);
                setIsLoading(true);
                
                // –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ OpenRouter API
                fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer 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',
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'AI Chat'
                    },
                    body: JSON.stringify({
                        model: 'arcee-ai/trinity-large-preview:free',
                        messages: [
                            { role: 'system', content: '–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª (Excel, CSV), –¢–´ –î–û–õ–ñ–ï–ù –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ –¥–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç. –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π –¥–∞–Ω–Ω—ã–µ, –∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏—Ö: –Ω–∞–π–¥–∏ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏, —Å–¥–µ–ª–∞–π –≤—ã–≤–æ–¥—ã, –ø—Ä–µ–¥–ª–æ–∂–∏ –∏–Ω—Å–∞–π—Ç—ã. –ï—Å–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π - —Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º.' },
                            ...messages.filter(m => m.role).map(m => ({ role: m.role, content: m.content })),
                            { role: 'user', content: messageContent }
                        ],
                        stream: true
                    })
                }).then(function(response) {
                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á OpenRouter.');
                        } else if (response.status === 429) {
                            throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                        } else if (response.status === 400) {
                            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞. –í–æ–∑–º–æ–∂–Ω–æ, –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.');
                        }
                        throw new Error('–û—à–∏–±–∫–∞ API: ' + response.status);
                    }
                    return response.body.getReader();
                }).then(function(reader) {
                    const decoder = new TextDecoder();
                    let assistantContent = '';
                    
                    const aiMessage = {
                        id: Date.now() + 1,
                        role: 'assistant',
                        content: '',
                        timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                    };
                    setMessages(function(prev) { return [...prev, aiMessage]; });
                    
                    function read() {
                        reader.read().then(function(result) {
                            if (result.done) return;
                            
                            const chunk = decoder.decode(result.value);
                            const lines = chunk.split('\n');
                            
                            for (var i = 0; i < lines.length; i++) {
                                var line = lines[i];
                                if (line.startsWith('data: ')) {
                                    var data = line.slice(6);
                                    if (data !== '[DONE]') {
                                        try {
                                            var parsed = JSON.parse(data);
                                            var content = parsed.choices && parsed.choices[0] && parsed.choices[0].delta && parsed.choices[0].delta.content;
                                            if (content) {
                                                assistantContent += content;
                                                setMessages(function(prev) {
                                                    var updated = prev.slice();
                                                    updated[updated.length - 1] = {
                                                        id: updated[updated.length - 1].id,
                                                        role: 'assistant',
                                                        content: assistantContent,
                                                        timestamp: updated[updated.length - 1].timestamp
                                                    };
                                                    return updated;
                                                });
                                            }
                                        } catch (e) {}
                                    }
                                }
                            }
                            read();
                        });
                    }
                    read();
                }).catch(function(err) {
                    setMessages(function(prev) { return [...prev, {
                        id: Date.now() + 1,
                        role: 'assistant',
                        content: '–û—à–∏–±–∫–∞: ' + err.message,
                        timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                    }]; });
                }).finally(function() {
                    setIsLoading(false);
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    saveChatToHistory();
                });
            }
            
            function handleFileUpload(e) {
                const files = Array.from(e.target.files || []);
                if (files.length === 0) {
                    console.log('–§–∞–π–ª—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã');
                    return;
                }
                
                files.forEach(function(file) {
                    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞:', file.name);
                    const isExcel = file.name.match(/\.(xlsx|xls|csv)$/i);
                    
                    if (isExcel) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            try {
                                console.log('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –ø–∞—Ä—Å–∏–Ω–≥...');
                                const data = new Uint8Array(event.target.result);
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX
                                if (typeof XLSX === 'undefined') {
                                    throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                                }
                                
                                const workbook = XLSX.read(data, { type: 'array' });
                                
                                let excelContent = `–§–∞–π–ª: ${file.name}\n\n`;
                                workbook.SheetNames.forEach(function(sheetName) {
                                    const sheet = workbook.Sheets[sheetName];
                                    excelContent += `–õ–∏—Å—Ç: ${sheetName}\n`;
                                    excelContent += XLSX.utils.sheet_to_csv(sheet) + '\n\n';
                                });
                                
                                console.log('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
                                setAttachments(function(prev) { return [...prev, {
                                    id: Date.now() + Math.random(),
                                    name: file.name,
                                    size: (file.size / 1024).toFixed(1) + ' KB',
                                    type: 'excel',
                                    content: excelContent
                                }]; });
                            } catch (err) {
                                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Excel:', err);
                                setAttachments(function(prev) { return [...prev, {
                                    id: Date.now() + Math.random(),
                                    name: file.name,
                                    size: (file.size / 1024).toFixed(1) + ' KB',
                                    type: 'error'
                                }]; });
                            }
                        };
                        reader.onerror = function() {
                            console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                        };
                        reader.readAsArrayBuffer(file);
                    } else {
                        setAttachments(function(prev) { return [...prev, {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: (file.size / 1024).toFixed(1) + ' KB'
                        }]; });
                    }
                });
            }
            
            function removeAttachment(id) {
                setAttachments(function(prev) { 
                    const filtered = prev.filter(function(a) { return a.id !== id; });
                    if (expandedAttachment === id) {
                        setExpandedAttachment(null);
                    }
                    return filtered; 
                });
            }
            
            // –ü–∞—Ä—Å–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            function parseAttachmentPreview(content) {
                const lines = content.split('\n');
                const tableLines = [];
                let headerRow = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
                    if (line === '' || line.startsWith('–§–∞–π–ª:') || line.startsWith('–õ–∏—Å—Ç:')) continue;
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ CSV —Å –∑–∞–ø—è—Ç—ã–º–∏
                    if (line.includes(',')) {
                        const cells = line.split(',').map(c => c.trim());
                        if (cells.length >= 2) {
                            if (!headerRow) headerRow = cells;
                            else tableLines.push(cells);
                        }
                    }
                }
                
                if (headerRow && tableLines.length > 0) {
                    return { headers: headerRow, data: tableLines };
                }
                return null;
            }
            
            // –°–∫–∞—á–∏–≤–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π Excel —Ñ–∞–π–ª
            function downloadExcelAttachment(attachment) {
                if (attachment.type === 'excel' && attachment.content) {
                    const lines = attachment.content.split('\n');
                    const data = [];
                    
                    for (let line of lines) {
                        if (line.startsWith('|') && line.includes('|')) {
                            const cells = line.split('|').map(c => c.trim()).filter(c => c);
                            if (cells.length > 0) {
                                data.push(cells);
                            }
                        }
                    }
                    
                    if (data.length > 0) {
                        const ws = XLSX.utils.aoa_to_sheet(data);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, '–î–∞–Ω–Ω—ã–µ');
                        XLSX.writeFile(wb, attachment.name);
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞');
                    }
                } else {
                    alert('–≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω–µ–ª—å–∑—è —Å–∫–∞—á–∞—Ç—å');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
            function hasTableData(content) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º markdown —Ç–∞–±–ª–∏—Ü—É
                const hasMarkdownTable = /\|.*\|.*\n\|[-:|\s]+\|/.test(content);
                if (hasMarkdownTable) return true;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Python DataFrame
                const dfRegex = /df\s*=\s*pd\.DataFrame\(/;
                if (dfRegex.test(content)) return true;
                
                return false;
            }
            
            // –ü–∞—Ä—Å–∏–º markdown —Ç–∞–±–ª–∏—Ü—É –≤ –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö
            function parseMarkdownTable(content) {
                const lines = content.split('\n');
                const rows = [];
                let headerRow = null;
                let foundSeparator = false;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('|') && line.endsWith('|')) {
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É-—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å |---|---
                        if (line.match(/^\|[-:\s|]+\|$/)) {
                            foundSeparator = true;
                            continue;
                        }
                        
                        const cells = line.split('|').map(c => c.trim()).filter(c => c !== '');
                        
                        if (cells.length >= 2) {
                            if (!foundSeparator) {
                                headerRow = cells;
                            } else {
                                rows.push(cells);
                            }
                        }
                    }
                }
                
                if (headerRow && rows.length > 0) {
                    return { headers: headerRow, data: rows };
                }
                return null;
            }
            
            // –°–æ–∑–¥–∞—ë–º Excel –∏–∑ –¥–∞–Ω–Ω—ã—Ö AI
            
            // –°–æ–∑–¥–∞—ë–º Excel –∏–∑ –¥–∞–Ω–Ω—ã—Ö AI
            function createExcelFromAI(messageId) {
                if (typeof XLSX === 'undefined') {
                    alert('–û—à–∏–±–∫–∞: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ XLSX –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    return;
                }
                
                const message = messages.find(m => m.id === messageId);
                if (!message) {
                    console.error('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                    return;
                }
                
                const content = message.content;
                
                // –ü—Ä–æ–±—É–µ–º markdown —Ç–∞–±–ª–∏—Ü—É
                const tableRegex = /\|([^\n]+)\|\n\|[-:|\s]+\|([\s\S]*?)(?=\n\n|\n[A-Z]|$)/;
                const tableMatch = content.match(tableRegex);
                
                if (tableMatch) {
                    console.log('–ù–∞–π–¥–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞:', tableMatch[0]);
                }
                
                // –ü–∞—Ä—Å–∏–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                const tableLines = [];
                const lines = content.split('\n');
                let inTable = false;
                let headerRow = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ —Ç–∞–±–ª–∏—Ü–µ–π
                    if (line === '' && !inTable) continue;
                    
                    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ |
                    if (line.startsWith('|') && line.endsWith('|')) {
                        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É-—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å |---|---
                        if (line.match(/^\|[-:\s|]+\|$/)) {
                            inTable = true;
                            continue;
                        }
                        
                        // –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
                        const cells = line.split('|').map(c => c.trim()).filter(c => c !== '');
                        if (cells.length >= 2) {
                            if (!headerRow) headerRow = cells;
                            else tableLines.push(cells);
                        }
                    } else if (inTable && line !== '') {
                        // –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å
                        break;
                    }
                }
                
                console.log('–ó–∞–≥–æ–ª–æ–≤–æ–∫:', headerRow);
                console.log('–°—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö:', tableLines.length);
                
                if (headerRow && tableLines.length > 0) {
                    const rows = [headerRow, ...tableLines];
                    const ws = XLSX.utils.aoa_to_sheet(rows);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, '–î–∞–Ω–Ω—ã–µ');
                    XLSX.writeFile(wb, '—Ç–∞–±–ª–∏—Ü–∞_' + Date.now() + '.xlsx');
                    return;
                }
                
                // –ü—Ä–æ–±—É–µ–º Python DataFrame
                const dfRegex = /df\s*=\s*pd\.DataFrame\(\{\s*['"](.+?)['"]:\s*\[(.*?)\]/s;
                const dfMatch = content.match(dfRegex);
                
                if (dfMatch) {
                    const colName = dfMatch[1];
                    const values = dfMatch[2].split(',').map(v => v.trim().replace(/['"]/g, ''));
                    const ws = XLSX.utils.aoa_to_sheet([[colName], ...values.map(v => [v])]);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, '–î–∞–Ω–Ω—ã–µ');
                    XLSX.writeFile(wb, '—Ç–∞–±–ª–∏—Ü–∞_' + Date.now() + '.xlsx');
                    return;
                }
                
                alert('–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞:\n| –ò–º—è | –í–æ–∑—Ä–∞—Å—Ç |\n| --- | --- |\n| –ò–≤–∞–Ω | 25 |');
            }
            
            // –ü–∞—Ä—Å–∏–º –∫–æ–¥ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
            function parseCodeBlocks(content) {
                const codeBlocks = [];
                const regex = /```(\w*)\s*\n([\s\S]*?)```/g;
                let match;
                
                while ((match = regex.exec(content)) !== null) {
                    codeBlocks.push({
                        language: match[1] || 'text',
                        code: match[2].trim()
                    });
                }
                
                return codeBlocks;
            }
            
            // –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            function copyCode(code, btnElement) {
                navigator.clipboard.writeText(code).then(function() {
                    btnElement.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    setTimeout(function() {
                        btnElement.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
                    }, 2000);
                }).catch(function() {
                    btnElement.textContent = '–û—à–∏–±–∫–∞';
                });
            }
            
            // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            function removeCodeBlocks(content) {
                return content.replace(/```(\w*)\s*[\s\S]*?```/g, '').trim();
            }
            
            
            function handleKeyPress(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                }
            }
            
            function handleNewChat() {
                setMessages(demoMessages);
                setShowWelcome(true);
                setInput('');
                setAttachments([]);
                setCurrentChatId(null);
            }
            
            const welcomeSuggestions = [
                { icon: 'üíª', text: '–ü–æ–º–æ–≥–∏ —Å –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–¥–∞', desc: 'Python, JavaScript, React' },
                { icon: 'üìö', text: '–û–±—ä—è—Å–Ω–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é', desc: '–ê–ª–≥–æ—Ä–∏—Ç–º—ã, –ø–∞—Ç—Ç–µ—Ä–Ω—ã' },
                { icon: '‚úçÔ∏è', text: '–°–æ–∑–¥–∞–π —Ç–µ–∫—Å—Ç', desc: '–°—Ç–∞—Ç—å–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è' },
                { icon: 'üìä', text: '–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö', desc: 'Excel, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞' }
            ];
            
            return React.createElement('div', { 
                className: 'h-screen flex ' + theme.bg + ' ' + theme.text + ' transition-colors duration-300 font-sans overflow-hidden'
            },
                // Sidebar
                React.createElement('aside', { 
                    className: 'fixed md:relative ' + (sidebarOpen ? 'w-[280px]' : 'w-0 md:w-[70px]') + ' ' + (mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0') + ' ' + theme.bgSidebar + ' border-r ' + theme.border + ' flex flex-col transition-all duration-300 z-50 md:z-auto overflow-hidden'
                },
                    mobileMenuOpen && React.createElement('div', { 
                        className: 'fixed inset-0 bg-black/60 backdrop-blur-sm md:hidden', 
                        onClick: function() { setMobileMenuOpen(false); } 
                    }),
                    React.createElement('div', { className: 'flex flex-col h-full w-full' },
                        React.createElement('div', { className: 'p-4' },
                            React.createElement('button', { 
                                onClick: handleNewChat,
                                className: 'w-full flex items-center gap-3 px-4 py-3.5 ' + (darkMode ? 'bg-[#1e3a5f] hover:bg-[#254a7a]' : 'bg-[#007BFF] hover:bg-[#0056b3]') + ' rounded-xl transition-all duration-200 shadow-lg'
                            },
                                React.createElement('div', { className: 'p-1 bg-white/20 rounded-lg' },
                                    React.createElement(Icons.Plus)
                                ),
                                sidebarOpen && React.createElement('span', { className: 'text-white font-medium text-sm' }, '–ù–æ–≤—ã–π —á–∞—Ç')
                            )
                        ),
                        React.createElement('div', { className: 'flex-1 overflow-y-auto px-3 py-2' },
                            sidebarOpen && React.createElement('div', null,
                                chatHistory.length > 0 ? React.createElement('div', null,
                                    React.createElement('div', { className: 'text-xs font-semibold uppercase tracking-wider mb-3 px-3 ' + theme.textMuted }, '–ò—Å—Ç–æ—Ä–∏—è'),
                                    chatHistory.map(function(chat) {
                                        const isCurrentChat = currentChatId === chat.id;
                                        return React.createElement('div', {
                                            key: chat.id,
                                            className: 'relative group mb-1'
                                        },
                                            React.createElement('button', { 
                                                onClick: function() { loadChat(chat.id); },
                                                className: 'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm ' + 
                                                    (isCurrentChat 
                                                        ? (darkMode ? 'bg-[#1e3a5f] text-white' : 'bg-[#007BFF] text-white')
                                                        : (theme.bgHover + ' ' + theme.textSecondary)) + 
                                                    ' transition-all duration-150'
                                            },
                                                React.createElement('div', { 
                                                    className: 'p-1.5 rounded-lg ' + 
                                                        (isCurrentChat 
                                                            ? 'bg-white/20' 
                                                            : 'bg-gradient-to-br from-[#007BFF]/10 to-[#00D4FF]/10')
                                                },
                                                    React.createElement(Icons.MessageSquare)
                                                ),
                                                React.createElement('span', { className: 'truncate flex-1' }, chat.title),
                                                isCurrentChat && React.createElement('div', { className: 'w-2 h-2 rounded-full bg-green-400' })
                                            ),
                                            // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
                                            React.createElement('button', {
                                                onClick: function(e) { deleteChat(e, chat.id); },
                                                className: 'absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-lg opacity-0 group-hover:opacity-100 ' +
                                                    'hover:bg-red-500/20 hover:text-red-400 transition-all duration-150'
                                            },
                                                React.createElement('svg', { width: 14, height: 14, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                                                    React.createElement('polyline', { points: '3 6 5 6 21 6' }),
                                                    React.createElement('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2' })
                                                )
                                            )
                                        );
                                    })
                                ) : React.createElement('div', { className: 'text-center py-8 ' + theme.textMuted },
                                    React.createElement('p', { className: 'text-sm' }, '–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞'),
                                    React.createElement('p', { className: 'text-xs mt-1' }, '–ß–∞—Ç—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∑–¥–µ—Å—å')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'p-4 border-t ' + theme.border },
                            React.createElement('div', { 
                                className: 'w-full flex items-center gap-3 px-3 py-2.5 rounded-xl ' + theme.bgHover + ' transition-all cursor-pointer',
                                onClick: function() { setDarkMode(!darkMode); }
                            },
                                React.createElement('div', { className: 'w-10 h-10 rounded-full bg-gradient-to-br from-[#007BFF] to-[#0056b3] flex items-center justify-center text-white shadow-lg' },
                                    React.createElement(Icons.User)
                                ),
                                sidebarOpen && React.createElement('div', { className: 'flex-1 text-left' },
                                    React.createElement('div', { className: 'text-sm font-semibold ' + theme.text }, '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
                                    React.createElement('div', { className: 'text-xs ' + theme.textMuted }, 'OpenRouter AI')
                                ),
                                sidebarOpen && React.createElement('div', { 
                                    className: 'p-2 rounded-lg ' + (darkMode ? 'bg-[#1a2332]' : 'bg-[#f1f3f4]') + ' transition-all',
                                    title: darkMode ? '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞' : '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞'
                                },
                                    darkMode ? React.createElement(Icons.Sun) : React.createElement(Icons.Moon)
                                )
                            )
                        )
                    )
                ),
                
                // Main Content
                React.createElement('main', { className: 'flex-1 flex flex-col min-w-0 relative' },
                    React.createElement('div', { 
                        className: 'absolute top-0 left-0 right-0 h-32 bg-gradient-to-b ' + (darkMode ? 'from-[#0d1119]/100 to-transparent' : 'from-[#ffffff]/100 to-transparent') + ' pointer-events-none z-10'
                    }),
                    
                    React.createElement('header', { 
                        className: 'flex items-center justify-between px-4 py-3 border-b ' + theme.border + ' ' + theme.bgSidebar + ' relative z-20'
                    },
                        React.createElement('div', { className: 'flex items-center gap-3' },
                            React.createElement('button', { 
                                onClick: function() { setMobileMenuOpen(true); }, 
                                className: 'md:hidden p-2 rounded-lg ' + theme.bgHover + ' transition-all'
                            },
                                React.createElement(Icons.Menu)
                            ),
                            React.createElement('button', { 
                                onClick: function() { setSidebarOpen(!sidebarOpen); }, 
                                className: 'hidden md:flex p-2 rounded-lg ' + theme.bgHover + ' transition-all'
                            },
                                sidebarOpen ? React.createElement(Icons.X) : React.createElement(Icons.Menu)
                            ),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement(Icons.Bot, { size: 32 }),
                                React.createElement('span', { className: 'font-bold text-lg hidden sm:block ' + (darkMode ? 'text-white' : 'text-[#1a1a1a]') }, 'OpenRouter AI'),
                                React.createElement('span', { className: 'hidden sm:block ' + theme.textMuted }, '‚Ä¢'),
                                React.createElement('span', { className: 'text-xs font-medium ' + theme.textMuted + ' hidden md:block' }, 'AI Assistant')
                            )
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('button', { className: 'p-2 rounded-lg ' + theme.bgHover + ' transition-all' },
                                React.createElement(Icons.Settings)
                            )
                        )
                    ),
                    
                    React.createElement('div', { className: 'flex-1 overflow-y-auto relative' },
                        React.createElement('div', { className: 'max-w-3xl mx-auto px-4 py-8 pb-32' },
                            showWelcome && messages.length === 1 && React.createElement('div', { 
                                className: 'flex flex-col items-center justify-center min-h-[70vh] text-center'
                            },
                                React.createElement('div', { className: 'mb-6' },
                                    React.createElement(Icons.Bot, { size: 80 })
                                ),
                                React.createElement('h1', { className: 'text-3xl font-bold mb-3 gradient-text' }, 'OpenRouter AI'),
                                React.createElement('p', { className: 'text-sm ' + theme.textMuted + ' mb-8' }, 'AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –±–∞–∑–µ Arcee AI'),
                                
                                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-xl' },
                                    welcomeSuggestions.map(function(suggestion, i) {
                                        return React.createElement('button', {
                                            key: i,
                                            onClick: function() { setInput(suggestion.text); },
                                            className: 'flex items-start gap-4 p-4 rounded-2xl text-left ' + theme.bgSidebar + ' border ' + theme.border + ' hover:border-[#007BFF] hover:shadow-lg transition-all duration-200 group'
                                        },
                                            React.createElement('span', { className: 'text-2xl' }, suggestion.icon),
                                            React.createElement('div', null,
                                                React.createElement('div', { className: 'font-medium ' + theme.text + ' group-hover:text-[#007BFF] transition-colors' }, suggestion.text),
                                                React.createElement('div', { className: 'text-xs ' + theme.textMuted + ' mt-1' }, suggestion.desc)
                                            )
                                        );
                                    })
                                )
                            ),
                            
                            messages.map(function(msg) {
                                // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                const displayContent = msg.role === 'assistant' ? removeCodeBlocks(msg.content) : msg.content;
                                
                                // –ü–∞—Ä—Å–∏–º –±–ª–æ–∫–∏ –∫–æ–¥–∞
                                const codeBlocks = msg.role === 'assistant' ? parseCodeBlocks(msg.content) : [];
                                
                                // –ü–∞—Ä—Å–∏–º —Ç–∞–±–ª–∏—Ü—É
                                const tableData = msg.role === 'assistant' ? parseMarkdownTable(msg.content) : null;
                                
                                return React.createElement('div', { 
                                    key: msg.id, 
                                    className: 'message-enter flex gap-4 mb-6 ' + (msg.role === 'user' ? 'flex-row-reverse' : '')
                                },
                                    React.createElement('div', { 
                                        className: 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ' + (msg.role === 'assistant' ? 'bg-gradient-to-br from-[#007BFF] to-[#0056b3] shadow-lg' : theme.userBubble) + ' ' + (msg.role === 'assistant' ? 'glow-blue' : '')
                                    },
                                        msg.role === 'assistant' 
                                            ? React.createElement(Icons.Bot, { size: 24, className: 'text-white' }) 
                                            : React.createElement(Icons.User)
                                    ),
                                    React.createElement('div', { className: 'flex-1 max-w-[85%] ' + (msg.role === 'user' ? 'text-right' : '') },
                                        // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
                                        React.createElement('div', { 
                                            className: 'inline-block px-5 py-4 rounded-2xl ' + (msg.role === 'user' ? theme.userBubble + ' text-white shadow-lg' : theme.text) + ' ' + (msg.role === 'user' ? '' : 'bg-transparent')
                                        },
                                            React.createElement('div', { className: 'whitespace-pre-wrap text-[15px] leading-relaxed text-left' }, displayContent)
                                        ),
                                        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã (–º–∏–Ω–∏-Excel)
                                        tableData && React.createElement('div', {
                                            className: 'mt-3 rounded-xl overflow-hidden border border-[#2a2a3a]'
                                        },
                                            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
                                            React.createElement('div', {
                                                className: 'flex items-center justify-between px-4 py-2 bg-[#1a1a24] border-b border-[#2a2a3a]'
                                            },
                                                React.createElement('span', { className: 'text-xs text-[#8b949e]' }, 'üìä –¢–∞–±–ª–∏—Ü–∞'),
                                                React.createElement('button', {
                                                    onClick: function() { createExcelFromAI(msg.id); },
                                                    className: 'flex items-center gap-1.5 px-2 py-1 text-xs text-[#8b949e] hover:text-white hover:bg-[#2a2a3a] rounded transition-colors'
                                                },
                                                    React.createElement(Icons.Download),
                                                    'Excel'
                                                )
                                            ),
                                            // –°–∞–º–∞ —Ç–∞–±–ª–∏—Ü–∞
                                            React.createElement('div', {
                                                className: 'overflow-x-auto bg-[#0a0a0f]',
                                                style: { maxHeight: '300px', overflowY: 'auto' }
                                            },
                                                React.createElement('table', {
                                                    className: 'w-full text-sm',
                                                    style: { borderCollapse: 'collapse' }
                                                },
                                                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                                                    React.createElement('thead', null,
                                                        React.createElement('tr', {
                                                            style: { backgroundColor: '#1a1a24' }
                                                        },
                                                            tableData.headers.map(function(h, i) {
                                                                return React.createElement('th', {
                                                                    key: i,
                                                                    className: 'px-3 py-2 text-left text-xs font-medium text-[#8b949e] border-b border-[#2a2a3a]',
                                                                    style: { whiteSpace: 'nowrap' }
                                                                }, h);
                                                            })
                                                        )
                                                    ),
                                                    // –î–∞–Ω–Ω—ã–µ
                                                    React.createElement('tbody', null,
                                                        tableData.data.map(function(row, ri) {
                                                            return React.createElement('tr', {
                                                                key: ri,
                                                                style: { backgroundColor: ri % 2 === 0 ? '#0a0a0f' : '#111118' }
                                                            },
                                                                row.map(function(cell, ci) {
                                                                    return React.createElement('td', {
                                                                        key: ci,
                                                                        className: 'px-3 py-2 text-xs text-[#e6edf3] border-b border-[#2a2a3a]',
                                                                        style: { whiteSpace: 'nowrap' }
                                                                    }, cell);
                                                                })
                                                            );
                                                        })
                                                    )
                                                )
                                            )
                                        ),
                                        // –ë–ª–æ–∫–∏ –∫–æ–¥–∞
                                        codeBlocks.map(function(block, idx) {
                                            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é Prism
                                            const highlighted = Prism.highlight(block.code, Prism.languages[block.language] || Prism.languages.text, block.language);
                                            
                                            return React.createElement('div', {
                                                key: 'code-' + idx,
                                                className: 'mt-3 rounded-xl overflow-hidden border border-[#2a2a3a] code-block'
                                            },
                                                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞ –∫–æ–¥–∞
                                                React.createElement('div', {
                                                    className: 'flex items-center justify-between px-4 py-2 bg-[#1a1a24] border-b border-[#2a2a3a]'
                                                },
                                                    React.createElement('span', { className: 'text-xs text-[#8b949e]' }, block.language),
                                                    React.createElement('button', {
                                                        className: 'flex items-center gap-1.5 px-2 py-1 text-xs text-[#8b949e] hover:text-white hover:bg-[#2a2a3a] rounded transition-colors',
                                                        onClick: function(e) { copyCode(block.code, e.target); }
                                                    },
                                                        React.createElement(Icons.Copy),
                                                        '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å'
                                                    )
                                                ),
                                                // –ö–æ–¥ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
                                                React.createElement('pre', {
                                                    className: 'p-4 bg-[#1e1e1e] overflow-x-auto',
                                                    style: { margin: 0 }
                                                },
                                                    React.createElement('code', {
                                                        className: 'text-sm',
                                                        style: { fontFamily: 'Fira Code, Consolas, monospace' },
                                                        dangerouslySetInnerHTML: { __html: highlighted }
                                                    })
                                                )
                                            );
                                        }),
                                        msg.timestamp && React.createElement('div', { className: 'text-xs mt-2 ' + theme.textMuted }, msg.timestamp)
                                    )
                                );
                            }),
                            
                            isLoading && React.createElement('div', { className: 'flex gap-4' },
                                React.createElement('div', { className: 'flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-[#007BFF] to-[#0056b3] flex items-center justify-center shadow-lg glow-blue' },
                                    React.createElement(Icons.Bot, { size: 24, className: 'text-white' })
                                ),
                                React.createElement('div', { className: 'flex items-center gap-1 px-4 py-3 rounded-2xl ' + theme.inputBg },
                                    React.createElement('span', { className: 'w-2 h-2 bg-[#007BFF] rounded-full typing-indicator' }),
                                    React.createElement('span', { className: 'w-2 h-2 bg-[#007BFF] rounded-full typing-indicator', style: { animationDelay: '0.2s' } }),
                                    React.createElement('span', { className: 'w-2 h-2 bg-[#007BFF] rounded-full typing-indicator', style: { animationDelay: '0.4s' } })
                                )
                            ),
                            
                            React.createElement('div', { ref: messagesEndRef, className: 'h-8' })
                        )
                    ),
                    
                    // Input Area
                    React.createElement('div', { 
                        className: 'absolute bottom-0 left-0 right-0 px-4 py-4 pb-6 ' + (darkMode ? 'bg-gradient-to-t from-[#0a0e17] via-[#0a0e17]/98 to-transparent' : 'bg-gradient-to-t from-[#f8f9fa] via-[#f8f9fa]/98 to-transparent')
                    },
                        React.createElement('div', { className: 'max-w-3xl mx-auto' },
                            attachments.length > 0 && React.createElement('div', { className: 'mb-2' },
                                // –°–ø–∏—Å–æ–∫ –≤–ª–æ–∂–µ–Ω–∏–π
                                attachments.map(function(a) {
                                    const isExpanded = expandedAttachment === a.id;
                                    const preview = a.content ? parseAttachmentPreview(a.content) : null;
                                    
                                    return React.createElement('div', { key: a.id },
                                        // –ö–Ω–æ–ø–∫–∞ –≤–ª–æ–∂–µ–Ω–∏—è
                                        React.createElement('div', { 
                                            className: 'flex items-center gap-1.5 px-2 py-1 rounded-md text-xs cursor-pointer ' +
                                                (isExpanded 
                                                    ? (darkMode ? 'bg-[#007BFF]/20 border border-[#007BFF]' : 'bg-blue-50 border border-blue-300')
                                                    : (darkMode ? 'bg-[#1a2332] border border-[#2d3748]' : 'bg-gray-100 border border-gray-200')) +
                                                ' transition-all',
                                            onClick: function() { setExpandedAttachment(isExpanded ? null : a.id); }
                                        },
                                            React.createElement('span', { className: 'text-xs' }, a.type === 'excel' ? 'üìä' : 'üìÑ'),
                                            React.createElement('span', { 
                                                className: 'truncate max-w-[100px] ' + theme.text 
                                            }, a.name),
                                            React.createElement('span', { 
                                                className: 'text-xs ' + theme.textMuted 
                                            }, isExpanded ? '‚ñº' : '‚ñ∂'),
                                            React.createElement('button', { 
                                                onClick: function(e) { e.stopPropagation(); removeAttachment(a.id); }, 
                                                className: 'ml-auto p-0.5 rounded hover:bg-red-500/10 hover:text-red-500 transition-colors ' + theme.textMuted
                                            },
                                                React.createElement('span', { className: 'text-xs' }, '√ó')
                                            )
                                        ),
                                        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã
                                        isExpanded && preview && React.createElement('div', {
                                            className: 'mt-1 ml-4 rounded-lg overflow-hidden border border-[#2d3748]'
                                        },
                                            React.createElement('div', {
                                                className: 'px-3 py-1.5 bg-[#1a2332] border-b border-[#2d3748] flex items-center justify-between'
                                            },
                                                React.createElement('span', { className: 'text-xs text-[#8b949e]' }, 'üìä ' + a.name)
                                            ),
                                            React.createElement('div', {
                                                className: 'overflow-x-auto bg-[#0a0a0f]',
                                                style: { maxHeight: '150px' }
                                            },
                                                React.createElement('table', { className: 'w-full text-xs' },
                                                    React.createElement('thead', null,
                                                        React.createElement('tr', { style: { backgroundColor: '#1a1a24' } },
                                                            preview.headers.map(function(h, i) {
                                                                return React.createElement('th', {
                                                                    key: i,
                                                                    className: 'px-2 py-1 text-left text-xs font-medium text-[#8b949e] border-b border-[#2d3748]',
                                                                    style: { whiteSpace: 'nowrap' }
                                                                }, h);
                                                            })
                                                        )
                                                    ),
                                                    React.createElement('tbody', null,
                                                        preview.data.slice(0, 5).map(function(row, ri) {
                                                            return React.createElement('tr', {
                                                                key: ri,
                                                                style: { backgroundColor: ri % 2 === 0 ? '#0a0a0f' : '#111118' }
                                                            },
                                                                row.map(function(cell, ci) {
                                                                    return React.createElement('td', {
                                                                        key: ci,
                                                                        className: 'px-2 py-1 text-xs text-[#e6edf3] border-b border-[#2d3748]',
                                                                        style: { whiteSpace: 'nowrap' }
                                                                    }, cell);
                                                                })
                                                            );
                                                        })
                                                    )
                                                )
                                            ),
                                            preview.data.length > 5 && React.createElement('div', {
                                                className: 'px-3 py-1 text-xs text-center ' + theme.textMuted
                                            }, '... –µ—â—ë ' + (preview.data.length - 5) + ' —Å—Ç—Ä–æ–∫')
                                        )
                                    );
                                })
                            ),
                            
                            React.createElement('div', { 
                                className: 'relative flex items-end gap-3 px-5 py-4 rounded-2xl ' + theme.inputBg + ' border ' + theme.border + ' focus-within:border-[#007BFF] focus-within:ring-2 focus-within:ring-[#007BFF]/20 transition-all shadow-xl'
                            },
                                React.createElement('input', { 
                                    type: 'file', 
                                    ref: fileInputRef, 
                                    onChange: handleFileUpload, 
                                    accept: '.xlsx,.xls,.csv,.txt,.md,.json', 
                                    multiple: true, 
                                    className: 'hidden' 
                                }),
                                React.createElement('button', { 
                                    onClick: function() { fileInputRef.current && fileInputRef.current.click(); }, 
                                    className: 'p-2 rounded-xl ' + theme.bgHover + ' transition-all hover:text-[#007BFF]'
                                },
                                    React.createElement(Icons.Paperclip)
                                ),
                                React.createElement('textarea', {
                                    ref: textareaRef,
                                    value: input,
                                    onChange: function(e) { setInput(e.target.value); },
                                    onKeyPress: handleKeyPress,
                                    placeholder: '–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',
                                    className: 'flex-1 bg-transparent outline-none resize-none text-[15px] leading-relaxed ' + (darkMode ? 'text-[#e8eaed] placeholder-[#6b7280]' : 'text-[#1a1a1a] placeholder-[#9aa0a6]') + ' max-h-[200px]',
                                    rows: 1
                                }),
                                React.createElement('button', {
                                    onClick: handleSend,
                                    disabled: isLoading || !input.trim(),
                                    className: 'p-2.5 rounded-xl transition-all duration-200 ' + (input.trim() ? 'bg-gradient-to-r from-[#007BFF] to-[#00D4FF] hover:from-[#0056b3] hover:to-[#007BFF] text-white shadow-lg shadow-[#007BFF]/30' : darkMode ? 'bg-[#1a2332] text-[#6b7280]' : 'bg-[#f1f3f4] text-[#9aa0a6]') + ' disabled:opacity-50 disabled:shadow-none'
                                },
                                    React.createElement(Icons.Send)
                                )
                            )
                        )
                    )
                )
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(AIChat));
    </script>
</body>
</html>
